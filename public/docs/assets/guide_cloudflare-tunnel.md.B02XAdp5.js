import{_ as a,o as i,c as n,ag as l}from"./chunks/framework.wGDfT7ie.js";const c=JSON.parse('{"title":"Cloudflare Tunnel","description":"","frontmatter":{},"headers":[],"relativePath":"guide/cloudflare-tunnel.md","filePath":"guide/cloudflare-tunnel.md"}'),e={name:"guide/cloudflare-tunnel.md"};function t(p,s,h,k,d,r){return i(),n("div",null,[...s[0]||(s[0]=[l(`<h1 id="cloudflare-tunnel" tabindex="-1">Cloudflare Tunnel <a class="header-anchor" href="#cloudflare-tunnel" aria-label="Permalink to &quot;Cloudflare Tunnel&quot;">​</a></h1><p>CloudPipe 使用 Cloudflare Tunnel 將本地服務暴露到公網，無需公網 IP 或設定防火牆。</p><h2 id="什麼是-cloudflare-tunnel" tabindex="-1">什麼是 Cloudflare Tunnel？ <a class="header-anchor" href="#什麼是-cloudflare-tunnel" aria-label="Permalink to &quot;什麼是 Cloudflare Tunnel？&quot;">​</a></h2><p>Cloudflare Tunnel（前身為 Argo Tunnel）是一個安全的方式，將你的本地服務連接到 Cloudflare 的邊緣網路：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>使用者 → Cloudflare CDN → Tunnel → 你的伺服器</span></span></code></pre></div><p>優點：</p><ul><li>不需要公網 IP</li><li>不需要開放防火牆 port</li><li>自動 HTTPS</li><li>DDoS 保護</li><li>全球 CDN 加速</li></ul><h2 id="安裝-cloudflared" tabindex="-1">安裝 cloudflared <a class="header-anchor" href="#安裝-cloudflared" aria-label="Permalink to &quot;安裝 cloudflared&quot;">​</a></h2><h3 id="windows" tabindex="-1">Windows <a class="header-anchor" href="#windows" aria-label="Permalink to &quot;Windows&quot;">​</a></h3><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用 winget</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">winget install Cloudflare.cloudflared</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或下載安裝檔</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/installation/</span></span></code></pre></div><h3 id="macos" tabindex="-1">macOS <a class="header-anchor" href="#macos" aria-label="Permalink to &quot;macOS&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudflared</span></span></code></pre></div><h3 id="linux" tabindex="-1">Linux <a class="header-anchor" href="#linux" aria-label="Permalink to &quot;Linux&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Debian/Ubuntu</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fsSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://pkg.cloudflare.com/cloudflare-main.gpg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/keyrings/cloudflare-archive-keyring.gpg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dev/null</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;deb [signed-by=/usr/share/keyrings/cloudflare-archive-keyring.gpg] https://pkg.cloudflare.com/cloudflared $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsb_release</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -cs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">) main&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apt/sources.list.d/cloudflared.list</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudflared</span></span></code></pre></div><h2 id="建立-tunnel" tabindex="-1">建立 Tunnel <a class="header-anchor" href="#建立-tunnel" aria-label="Permalink to &quot;建立 Tunnel&quot;">​</a></h2><h3 id="_1-登入-cloudflare" tabindex="-1">1. 登入 Cloudflare <a class="header-anchor" href="#_1-登入-cloudflare" aria-label="Permalink to &quot;1. 登入 Cloudflare&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> login</span></span></code></pre></div><p>會打開瀏覽器，選擇你的 domain 並授權。</p><h3 id="_2-建立-tunnel" tabindex="-1">2. 建立 Tunnel <a class="header-anchor" href="#_2-建立-tunnel" aria-label="Permalink to &quot;2. 建立 Tunnel&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudpipe</span></span></code></pre></div><p>會生成一個 Tunnel ID 和 credentials 檔案。</p><h3 id="_3-設定-dns" tabindex="-1">3. 設定 DNS <a class="header-anchor" href="#_3-設定-dns" aria-label="Permalink to &quot;3. 設定 DNS&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 主域名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudpipe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> epi.isnowfriend.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Wildcard（用於子域名）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudpipe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;*.isnowfriend.com&quot;</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Wildcard DNS 需要在 Cloudflare Dashboard 手動設定，或使用 Cloudflare API。</p></div><h3 id="_4-建立設定檔" tabindex="-1">4. 建立設定檔 <a class="header-anchor" href="#_4-建立設定檔" aria-label="Permalink to &quot;4. 建立設定檔&quot;">​</a></h3><p>建立 <code>~/.cloudflared/config.yml</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tunnel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;your-tunnel-id&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">credentials-file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/path/to/credentials.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ingress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 主服務</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">epi.isnowfriend.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:8787</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Wildcard 子域名（給部署的專案用）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*.isnowfriend.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:8787</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 預設處理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http_status:404</span></span></code></pre></div><h3 id="_5-啟動-tunnel" tabindex="-1">5. 啟動 Tunnel <a class="header-anchor" href="#_5-啟動-tunnel" aria-label="Permalink to &quot;5. 啟動 Tunnel&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudpipe</span></span></code></pre></div><h2 id="整合-cloudpipe" tabindex="-1">整合 CloudPipe <a class="header-anchor" href="#整合-cloudpipe" aria-label="Permalink to &quot;整合 CloudPipe&quot;">​</a></h2><h3 id="start-bat-自動啟動" tabindex="-1">start.bat 自動啟動 <a class="header-anchor" href="#start-bat-自動啟動" aria-label="Permalink to &quot;start.bat 自動啟動&quot;">​</a></h3><p>CloudPipe 的 <code>start.bat</code> 已經包含 tunnel 啟動：</p><div class="language-batch vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">batch</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@echo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> off</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CloudPipe - Local Deploy Gateway</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ================================</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [1/3] Stopping old instance...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pm2 delete cloudpipe </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nul</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [2/3] Starting server with PM2...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pm2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.js --name cloudpipe</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [3/3] Starting tunnel...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /B cloudflared tunnel run cloudpipe</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Done! Server running at https://epi.isnowfriend.com</span></span></code></pre></div><h3 id="作為服務運行" tabindex="-1">作為服務運行 <a class="header-anchor" href="#作為服務運行" aria-label="Permalink to &quot;作為服務運行&quot;">​</a></h3><h4 id="windows-1" tabindex="-1">Windows <a class="header-anchor" href="#windows-1" aria-label="Permalink to &quot;Windows&quot;">​</a></h4><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cloudflared service install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cloudflared service start</span></span></code></pre></div><h4 id="linux-systemd" tabindex="-1">Linux (systemd) <a class="header-anchor" href="#linux-systemd" aria-label="Permalink to &quot;Linux (systemd)&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudflared</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudflared</span></span></code></pre></div><h2 id="tunnel-架構" tabindex="-1">Tunnel 架構 <a class="header-anchor" href="#tunnel-架構" aria-label="Permalink to &quot;Tunnel 架構&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>                    Cloudflare Network</span></span>
<span class="line"><span>                    ┌─────────────────────────────┐</span></span>
<span class="line"><span>                    │                             │</span></span>
<span class="line"><span>User ──────────────►│  epi.isnowfriend.com       │</span></span>
<span class="line"><span>                    │         │                   │</span></span>
<span class="line"><span>                    │         ▼                   │</span></span>
<span class="line"><span>                    │  *.isnowfriend.com         │</span></span>
<span class="line"><span>                    │         │                   │</span></span>
<span class="line"><span>                    └─────────┼───────────────────┘</span></span>
<span class="line"><span>                              │</span></span>
<span class="line"><span>                              │ Tunnel (encrypted)</span></span>
<span class="line"><span>                              │</span></span>
<span class="line"><span>                    ┌─────────▼───────────────────┐</span></span>
<span class="line"><span>                    │    Your Server              │</span></span>
<span class="line"><span>                    │                             │</span></span>
<span class="line"><span>                    │  cloudflared ◄──────────────┤</span></span>
<span class="line"><span>                    │       │                     │</span></span>
<span class="line"><span>                    │       ▼                     │</span></span>
<span class="line"><span>                    │  CloudPipe (localhost:8787) │</span></span>
<span class="line"><span>                    │       │                     │</span></span>
<span class="line"><span>                    │       ├──► services/        │</span></span>
<span class="line"><span>                    │       └──► apps/            │</span></span>
<span class="line"><span>                    └─────────────────────────────┘</span></span></code></pre></div><h2 id="多-tunnel-設定" tabindex="-1">多 Tunnel 設定 <a class="header-anchor" href="#多-tunnel-設定" aria-label="Permalink to &quot;多 Tunnel 設定&quot;">​</a></h2><p>如果你有多個服務：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># config.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tunnel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cloudpipe</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">credentials-file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/path/to/credentials.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ingress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # CloudPipe 主服務</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">epi.isnowfriend.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:8787</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 子域名專案</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*.isnowfriend.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:8787</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 其他服務</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">hostname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">api.example.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http_status:404</span></span></code></pre></div><h2 id="問題排解" tabindex="-1">問題排解 <a class="header-anchor" href="#問題排解" aria-label="Permalink to &quot;問題排解&quot;">​</a></h2><h3 id="tunnel-無法連線" tabindex="-1">Tunnel 無法連線 <a class="header-anchor" href="#tunnel-無法連線" aria-label="Permalink to &quot;Tunnel 無法連線&quot;">​</a></h3><ol><li>檢查 cloudflared 是否運行：</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudpipe</span></span></code></pre></div><ol start="2"><li><p>檢查 credentials 檔案是否存在</p></li><li><p>查看日誌：</p></li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudpipe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --loglevel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> debug</span></span></code></pre></div><h3 id="dns-解析失敗" tabindex="-1">DNS 解析失敗 <a class="header-anchor" href="#dns-解析失敗" aria-label="Permalink to &quot;DNS 解析失敗&quot;">​</a></h3><p>確認 DNS 記錄已設定：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 檢查 DNS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nslookup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> epi.isnowfriend.com</span></span></code></pre></div><p>應該指向 Cloudflare IP。</p><h3 id="_502-bad-gateway" tabindex="-1">502 Bad Gateway <a class="header-anchor" href="#_502-bad-gateway" aria-label="Permalink to &quot;502 Bad Gateway&quot;">​</a></h3><p>通常是本地服務沒有運行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 確認 CloudPipe 正在運行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pm2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 確認 port 正確</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8787</span></span></code></pre></div><h2 id="監控" tabindex="-1">監控 <a class="header-anchor" href="#監控" aria-label="Permalink to &quot;監控&quot;">​</a></h2><h3 id="cloudflare-dashboard" tabindex="-1">Cloudflare Dashboard <a class="header-anchor" href="#cloudflare-dashboard" aria-label="Permalink to &quot;Cloudflare Dashboard&quot;">​</a></h3><p>登入 Cloudflare Dashboard → Zero Trust → Access → Tunnels</p><p>可以看到：</p><ul><li>Tunnel 狀態</li><li>流量統計</li><li>連線數</li></ul><h3 id="本地日誌" tabindex="-1">本地日誌 <a class="header-anchor" href="#本地日誌" aria-label="Permalink to &quot;本地日誌&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 tunnel 日誌</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudflared</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cloudpipe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --loglevel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span></span></code></pre></div><h2 id="安全建議" tabindex="-1">安全建議 <a class="header-anchor" href="#安全建議" aria-label="Permalink to &quot;安全建議&quot;">​</a></h2><ol><li><strong>使用 Access Policy</strong>：限制誰可以訪問管理介面</li><li><strong>啟用 WARP</strong>：為內部用戶提供更快的連線</li><li><strong>設定 IP 白名單</strong>：在 Cloudflare 防火牆規則中限制來源 IP</li></ol>`,65)])])}const u=a(e,[["render",t]]);export{c as __pageData,u as default};
