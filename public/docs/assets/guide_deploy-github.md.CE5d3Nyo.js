import{_ as a,o as i,c as t,ag as n}from"./chunks/framework.wGDfT7ie.js";const c=JSON.parse('{"title":"GitHub 部署","description":"","frontmatter":{},"headers":[],"relativePath":"guide/deploy-github.md","filePath":"guide/deploy-github.md"}'),e={name:"guide/deploy-github.md"};function l(p,s,h,o,d,r){return i(),t("div",null,[...s[0]||(s[0]=[n(`<h1 id="github-部署" tabindex="-1">GitHub 部署 <a class="header-anchor" href="#github-部署" aria-label="Permalink to &quot;GitHub 部署&quot;">​</a></h1><p>CloudPipe 支援從 GitHub 自動部署，push 到 repo 後幾秒內就會自動更新。</p><h2 id="建立專案" tabindex="-1">建立專案 <a class="header-anchor" href="#建立專案" aria-label="Permalink to &quot;建立專案&quot;">​</a></h2><h3 id="透過-dashboard" tabindex="-1">透過 Dashboard <a class="header-anchor" href="#透過-dashboard" aria-label="Permalink to &quot;透過 Dashboard&quot;">​</a></h3><ol><li>打開 Dashboard → 部署管理</li><li>點擊「新增專案」</li><li>填入： <ul><li><strong>專案 ID</strong>：唯一識別碼，會變成 subdomain（如 <code>my-app.isnowfriend.com</code>）</li><li><strong>GitHub URL</strong>：repo 網址</li><li><strong>Branch</strong>：要部署的分支（預設 <code>main</code>）</li></ul></li></ol><h3 id="透過-api" tabindex="-1">透過 API <a class="header-anchor" href="#透過-api" aria-label="Permalink to &quot;透過 API&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://epi.isnowfriend.com/api/_admin/deploy/projects</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$TOKEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;id&quot;: &quot;my-app&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;name&quot;: &quot;My App&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;deployMethod&quot;: &quot;github&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;repoUrl&quot;: &quot;https://github.com/you/my-app&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;branch&quot;: &quot;main&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }&#39;</span></span></code></pre></div><h2 id="自動部署機制" tabindex="-1">自動部署機制 <a class="header-anchor" href="#自動部署機制" aria-label="Permalink to &quot;自動部署機制&quot;">​</a></h2><p>CloudPipe 有兩種自動部署方式：</p><h3 id="_1-webhook-即時" tabindex="-1">1. Webhook（即時） <a class="header-anchor" href="#_1-webhook-即時" aria-label="Permalink to &quot;1. Webhook（即時）&quot;">​</a></h3><p>建立專案時會自動設定 GitHub Webhook。當你 push 到指定 branch：</p><ol><li>GitHub 發送 webhook 到 <code>https://epi.isnowfriend.com/webhook/{project-id}</code></li><li>CloudPipe 驗證簽名</li><li>觸發部署流程</li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>新建專案時 Webhook 會自動設定，不需要手動操作。</p></div><h3 id="_2-polling-備援" tabindex="-1">2. Polling（備援） <a class="header-anchor" href="#_2-polling-備援" aria-label="Permalink to &quot;2. Polling（備援）&quot;">​</a></h3><p>每 5 分鐘檢查一次 GitHub 最新 commit，如果有新的就自動部署。</p><p>這是備援機制，萬一 webhook 沒觸發也不會漏掉更新。</p><h2 id="部署流程" tabindex="-1">部署流程 <a class="header-anchor" href="#部署流程" aria-label="Permalink to &quot;部署流程&quot;">​</a></h2><p>當觸發部署時，CloudPipe 會執行：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. git fetch origin {branch}</span></span>
<span class="line"><span>2. git reset --hard origin/{branch}</span></span>
<span class="line"><span>3. 偵測 package manager (pnpm/yarn/npm)</span></span>
<span class="line"><span>4. 安裝依賴（有快取，依賴沒變不會重裝）</span></span>
<span class="line"><span>5. 執行 build（如果 package.json 有 build script）</span></span>
<span class="line"><span>6. PM2 重啟服務</span></span>
<span class="line"><span>7. Health Check 確認啟動</span></span>
<span class="line"><span>8. 更新 DNS（如果是新專案）</span></span></code></pre></div><h2 id="支援的專案類型" tabindex="-1">支援的專案類型 <a class="header-anchor" href="#支援的專案類型" aria-label="Permalink to &quot;支援的專案類型&quot;">​</a></h2><table tabindex="0"><thead><tr><th>類型</th><th>偵測方式</th><th>啟動方式</th></tr></thead><tbody><tr><td><strong>Node.js</strong></td><td>有 <code>server.js</code> 或 <code>index.js</code></td><td><code>pm2 start server.js</code></td></tr><tr><td><strong>Next.js</strong></td><td><code>package.json</code> 有 <code>next</code> dependency</td><td><code>pm2 start next -- start</code></td></tr><tr><td><strong>其他框架</strong></td><td><code>package.json</code> 有 <code>scripts.start</code></td><td><code>pm2 start npm -- start</code></td></tr><tr><td><strong>靜態網站</strong></td><td>無 <code>package.json</code> 或無 start script</td><td>直接 serve 靜態檔案</td></tr></tbody></table><h2 id="手動觸發部署" tabindex="-1">手動觸發部署 <a class="header-anchor" href="#手動觸發部署" aria-label="Permalink to &quot;手動觸發部署&quot;">​</a></h2><p>如果想手動重新部署：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 透過 API</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://epi.isnowfriend.com/api/_admin/deploy/projects/{id}/deploy</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$TOKEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 透過 CLI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudpipe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {id}</span></span></code></pre></div><h2 id="查看部署記錄" tabindex="-1">查看部署記錄 <a class="header-anchor" href="#查看部署記錄" aria-label="Permalink to &quot;查看部署記錄&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># API</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://epi.isnowfriend.com/api/_admin/deploy/deployments</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$TOKEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CLI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cloudpipe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {id}</span></span></code></pre></div><p>每次部署都會記錄：</p><ul><li>觸發方式（webhook / poll / manual）</li><li>Commit hash 和訊息</li><li>執行時間</li><li>成功/失敗狀態</li><li>詳細 log</li></ul>`,28)])])}const u=a(e,[["render",l]]);export{c as __pageData,u as default};
